<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/Html.html to edit this template
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--        <link rel="stylesheet" href="./dashboard.css">-->
        <style> 
            
            body {
                font-family: Arial, sans-serif;
                background-color: #f2f2f2;
            }
            h1 {
                color: #333;
            }
            .container {
                max-width: 900px;
                margin: 0 auto;
                padding: 40px;
                background-color: #fff;
                margin-bottom: 40px;
            }
            .button {
                padding: 10px 20px;
                background-color: #333;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            .appointments {
                margin-top: 20px;
                border-collapse: collapse;
                width: 100%;
            }
            .appointments th, .appointments td {
                padding: 10px;
                border-bottom: 1px solid #ddd;
                text-align: left;
            }
            .appointments th {
                background-color: #333;
                color: #fff;
                margin-bottom: 40px;
            }
            

#jobSeekerForm {
    max-width: 400px; /* Set a maximum width for the form */
    margin: 0 auto; /* Center the form horizontally */
    padding: 20px; /* Add padding for spacing */
    background-color: #fff; /* Set a background color for the form */
    border-radius: 8px; /* Add rounded corners */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add a subtle box shadow */
}

#jobSeekerForm label {
    display: block;
    margin-bottom: 8px;
}

#jobSeekerForm input,
#jobSeekerForm select {
    width: 100%;
    padding: 10px;
    margin-bottom: 16px;
    box-sizing: border-box;
}

#jobSeekerForm button {
    width: 100%;
    padding: 10px 20px;
    background-color: #333;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

            .container {
                max-width: 900px;
                margin: 0 auto;
                padding: 40px;
/*                background-color: #fff;*/
                margin-bottom: 40px;
                margin-left: 50px;
                margin-top: 25px;
            }
            .button {
                padding: 10px 20px;
                background-color: #333;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            .appointments {
                margin-top: 20px;
                border-collapse: collapse;
                width: 100%;
            }
            .appointments th, .appointments td {
                padding: 10px;
                border-bottom: 1px solid #ddd;
                text-align: left;
            }
            .appointments th {
                background-color: #333;
                color: #fff;
                margin-bottom: 40px;
            }

        </style>
    </head>
    <body>
        <header>
            <h1>Job Seeker Dashboard</h1>
        </header>




        <div class="container"> 
            <h1>Job Seekers Page</h1>
            <h2>Appointment Requests</h2>
            <table class="appointments">
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Job Seeker</th>
                    <th>Actions</th>
                </tr>
                <tr>
                    <td>2022-01-10</td>
                    <td>09:00 AM</td>
                    <td>John Smith</td>
                    <td>
                        <button class="button">Accept</button>
                        <button class="button">Reject</button>
                    </td>
                </tr>
                <tr>
                    <td>2022-01-12</td>
                    <td>03:00 PM</td>
                    <td>Jane Doe</td>
                    <td>
                        <button class="button">Accept</button>
                        <button class="button">Reject</button>
                    </td>
                </tr>
            </table>

            <h2>Schedule New Appointment</h2>
            <form>
                <label for="date">Date:</label>
                <input type="date" id="date" name="date">
                <label for="time">Time:</label>
                <input type="time" id="time" name="time">
                <label for="jobSeeker">Job Seeker:</label>
                <input type="text" id="jobSeeker" name="jobSeeker">
                <input type="submit" value="Schedule" class="button">
            </form>

            <h2>Available Consultants</h2>
            <table class="appointments" id="consultantsTable">
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Consultant Name</th>
                    <th>Status</th>
                </tr>
            </table>

        </div>


            
  


<form id="jobSeekerForm">
    <label for="fullName">Full Name:</label>
    <input type="text" id="fullName" name="fullName" required><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br>

    <label for="phone">Phone:</label>
    <input type="tel" id="phone" name="phone" required><br>

    <label for="consultant">Select Consultant:</label>
    <select id="consultant" name="consultant"></select><br>

    <label for="status">Status:</label>
    <select id="status" name="status" disabled>
        <option value="pending">Pending</option>
        <option value="accepted">Accepted</option>
        <option value="rejected">Rejected</option>
        <option value="Completed">Completed</option>
    </select><br>

<!--    <button type="button" id="bookAppointmentBtn">Book Appointment</button>-->
    <button type="button" id="bookAppointmentBtn" onclick="bookAppointment()">Book Appointment</button>
    
        

</form>
        
        
        <div class="container">
        <h1>Consultant Page</h1>
        <h2>Appointment Requests</h2>
        <table class="appointments" id="appointmentsTable">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Consultant</th>
                <th>Status</th>
                
            </tr>
        </table>
    </div>


        <script>
            function submitForm() {
                // Get form values
                const fullName = document.getElementById('fullName').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const selectedConsultant = document.getElementById('consultant').value;

                // You can now send these values to your backend (Java) using AJAX or fetch API
                // For simplicity, let's log them to the console
                console.log('Full Name:', fullName);
                console.log('Email:', email);
                console.log('Phone:', phone);
                console.log('Selected Consultant:', selectedConsultant);

                // You can add logic to send this data to your Java backend and handle the response
                // For now, let's just alert a success message
                alert('Appointment booked successfully!');

            }

            function viewConsultants() {
                // Make an API request to retrieve all consultants
                fetch("http://localhost:8080/REGISTER-BACKEND/resources/student/viewConsultants", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                })
                        .then((response) => {
                            if (response.status === 200) {
                                return response.json();
                            } else {
                                throw new Error("Failed to fetch consultants");
                            }
                        })
                        .then((consultants) => {
                            // Display the consultants in the HTML table
                            displayConsultants(consultants);
                        })
                        .catch((error) => {
                            // Handle errors and display an error message
                            console.error(error);
                        });
            }

            function displayConsultants(consultants) {
                const table = document.getElementById("consultantsTable");

                // Clear existing rows
                while (table.rows.length > 1) {
                    table.deleteRow(1);
                }

                // Populate the table with fetched consultants
                consultants.forEach((consultant, index) => {
                    const row = table.insertRow(index + 1);
                    const dateCell = row.insertCell(0);
                    const timeCell = row.insertCell(1);
                    const nameCell = row.insertCell(2);
                    const statusCell = row.insertCell(3);

                    dateCell.textContent = consultant.date;
                    timeCell.textContent = consultant.time;
                    nameCell.textContent = consultant.name;
                    statusCell.textContent = "Upcoming"; // You may need to modify this based on the actual status data
                });
            }

    // Call the viewConsultants function when the page loads
            //window.onload = viewConsultants;

            
            
            
            
            
document.addEventListener("DOMContentLoaded", function () {
    // Fetch consultant names from the API endpoint
    fetch("http://localhost:8080/REGISTER-BACKEND/resources/student/con_names")
        .then(response => response.json())
        .then(consultantNames => {
            // Populate the dropdown with fetched consultant names
            const consultantDropdown = document.getElementById("consultant");

            consultantNames.forEach(name => {
                const option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                consultantDropdown.appendChild(option);
            });
        })
        .catch(error => console.error("Error fetching consultant names:", error));
});



function bookAppointment() {
        // Get form values
        const fullName = document.getElementById('fullName').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const selectedConsultant = document.getElementById('consultant').value;
        const selectedStatus = document.getElementById('status').value;

        // Create appointment data object
        const appointmentData = {
            fullName: fullName,
            email: email,
            phone: phone,
            consultant: selectedConsultant,
            status: selectedStatus
        };

        // Make API call to add appointment
        fetch("http://localhost:8080/REGISTER-BACKEND/resources/student/book", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(appointmentData),
        })
            .then(response => {
                if (response.status === 201) {
                    alert('Appointment booked successfully!');
                } else {
                    alert('Failed to book appointment. Please try again.');
                }
            })
            .catch(error => console.error("Error booking appointment:", error));
    }
    
    
    
    
    
    
    function fetchAppointments() {
    // Make an API request to retrieve all appointments
    fetch("http://localhost:8080/REGISTER-BACKEND/resources/student/fetch_appointment", {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
        },
    })
        .then((response) => {
            if (response.status === 200) {
                return response.json();
            } else {
                throw new Error("Failed to fetch appointments");
            }
        })
        .then((appointments) => {
            // Display the appointments in the HTML table
            displayAppointments(appointments);
        })
        .catch((error) => {
            // Handle errors and display an error message
            console.error(error);
            showAlert("Failed to fetch appointments");
        });
}

function displayAppointments(appointments) {
    const table = document.getElementById("appointmentsTable");

    // Clear existing rows
    while (table.rows.length > 1) {
        table.deleteRow(1);
    }

    // Populate the table with fetched appointments
    appointments.forEach((appointment, index) => {
        const row = table.insertRow(index + 1);

        // Create and append input fields to each cell
        createInputCell(row, 0, appointment.id, "id", "id");
        createInputCell(row, 1, appointment.fullName, "name", "fullName");
        createInputCell(row, 2, appointment.email, "email", "email");
        createInputCell(row, 3, appointment.phone, "phone", "phone");
        createInputCell(row, 4, appointment.consultant, "consultant", "consultant");
        createInputCell(row, 5, appointment.status, "status", "status");
    });
}

// Function to create input cells for the table
function createInputCell(row, cellIndex, value, dataId, fieldName) {
    const cell = row.insertCell(cellIndex);

    // Create input field for all columns
    const input = document.createElement("input");
    input.type = "text";
    input.value = value;
    input.setAttribute("data-id", dataId);
    input.setAttribute("data-field", fieldName);
    
    // Disable input fields to prevent editing
    input.disabled = true;

    cell.appendChild(input);

    return cell;
}


// Call the fetchAppointments function when the page loads
//window.onload = fetchAppointments;
//window.onload = viewConsultants;

window.addEventListener('load', function () {
    fetchAppointments();
    viewConsultants();
});






function createInputCell(row, cellIndex, value, dataId, fieldName) {
    const cell = row.insertCell(cellIndex);

    if (fieldName === "status") {
        // Create a dropdown for the status field
        const dropdown = document.createElement("select");
        const options = ["Pending", "Accepted", "Rejected", "Completed"];

        options.forEach(optionValue => {
            const option = document.createElement("option");
            option.value = optionValue;
            option.text = optionValue;
            dropdown.appendChild(option);
        });

        dropdown.value = value; // Set the default value

        dropdown.setAttribute("data-id", dataId);
        dropdown.setAttribute("data-field", fieldName);

        cell.appendChild(dropdown);
    } else {
        // Create input field for other columns
        const input = document.createElement("input");
        input.type = "text";
        input.value = value;
        input.setAttribute("data-id", dataId);
        input.setAttribute("data-field", fieldName);

        cell.appendChild(input);
    }

    return cell;
}

function editAppointment(appointmentId) {
    console.log("Editing appointment with ID:", appointmentId);

    const row = document.querySelector(`[data-id="${appointmentId}"]`);
    if (!row) {
        console.error(`Row with ID ${appointmentId} not found.`);
        return;
    }

    // Find input fields within the row using data-id attribute
    const inputs = row.querySelectorAll('[data-id]');

    const updatedAppointment = {};
    inputs.forEach(input => {
        const fieldName = input.getAttribute("data-field");
        updatedAppointment[fieldName] = input.value;
    });

    const updurl = "http://localhost:8080/REGISTER-BACKEND/resources/student/updateAppointment";

    const options = {
        method: "PUT",
        headers: {
            "content-type": "application/json"
        },
        body: JSON.stringify(updatedAppointment)
    };

    fetch(updurl, options)
        .then(response => {
            if (response.status === 200) {
                // Display a success message
                alert("Student successfully updated!");
            } else {
                // Handle other status codes here
                alert("Student not successfully updated!");
                throw new Error("Error: " + response.status);
            }
        })
        .catch(error => {
            console.error(error);
        });
}
            

        </script>



    </body>
</html>
